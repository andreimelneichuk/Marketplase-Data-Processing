# Проект: Импорт товаров из XML в PostgreSQL и индексация в Elasticsearch

## Описание проекта

Данный проект загружает товары из XML-файла в базу данных PostgreSQL и индексирует их в Elasticsearch для поиска. Скрипт автоматически создает таблицу товаров, если она не существует, и обрабатывает товары, загружая их партиями. Процесс включает парсинг характеристик продуктов и загрузку их в Elasticsearch для дальнейшей индексации и поиска.

## Технологии

- **PostgreSQL** для хранения данных о товарах.
- **Elasticsearch** для индексации данных и поиска.
- **Python** для обработки данных, парсинга XML и работы с базами данных.
- **Docker** для контейнеризации всех компонентов.

## Как запустить проект

### Предварительные шаги

1. Убедитесь, что у вас установлен Docker и Docker Compose.
2. Склонируйте репозиторий с проектом.

```bash
git clone <репозиторий>
cd <папка_проекта>
```

3. Поместите XML-файл с товарами в корень проекта и назовите его `offers.xml` или измените путь в коде, если нужно другое имя файла.

### Установка зависимостей

Для локального запуска установите необходимые Python-зависимости:

```bash
pip install -r requirements.txt
```

### Запуск с Docker

Проект настроен для работы с Docker Compose, что упрощает запуск всех необходимых сервисов.

1. Постройте и запустите контейнеры:

```bash
docker-compose up --build
```

2. Подождите, пока все сервисы будут готовы. Логи будут отображать статус подключения к PostgreSQL и Elasticsearch.

### Настройка индекса в Elasticsearch

После запуска контейнеров, сервис автоматически создаст индекс в Elasticsearch с соответствующей схемой.

## Проверка функционала

1. **Парсинг XML и загрузка в PostgreSQL**: 
   - Скрипт обрабатывает XML-файл и сохраняет данные в таблицу `sku` базы данных PostgreSQL.
   - Продукты загружаются партиями для оптимизации производительности.

2. **Индексация в Elasticsearch**:
   - После загрузки в базу данных товары индексируются в Elasticsearch.
   - Для проверки индекса можно воспользоваться командой:
   
   ```bash
   curl -X GET 'http://localhost:9200/products/_search?pretty'
   ```

   Это вернет список всех проиндексированных товаров.

## Как завершить выполнение

Чтобы завершить выполнение приложения и остановить все контейнеры:

```bash
docker-compose down
```

Это остановит и удалит все контейнеры, освобождая ресурсы.

## Логи

Логи работы приложения сохраняются в файл `app.log`. В нем можно отслеживать ошибки и этапы выполнения.

## Ошибки и возможные проблемы

- **Ошибка подключения к PostgreSQL или Elasticsearch**: Проверьте, что сервисы запущены и доступны. Возможно, стоит увеличить время ожидания в настройках контейнера.
- **Проблемы с памятью или производительностью**: Вы можете настроить лимиты использования ресурсов в файле `docker-compose.yml`.

---

Таким образом, проект автоматизирует процесс импорта данных с маркетплейса и их индексации для удобного поиска и анализа.