# Проект: Импорт товаров из XML в PostgreSQL и индексация в Elasticsearch

## Описание проекта

Данный проект загружает товары из XML-файла в базу данных PostgreSQL и индексирует их в Elasticsearch для поиска. Скрипт автоматически создает таблицу товаров, если она не существует, и обрабатывает товары, загружая их партиями. Процесс включает парсинг характеристик продуктов и загрузку их в Elasticsearch для дальнейшей индексации и поиска.

## Файл offers.xml
Файл для скачивания доступен по [ссылке](https://disk.yandex.com/d/WLKyKITo46WTIQ). Его нужно добавить в папку с проектом для запуска.


## Технологии

- **PostgreSQL** для хранения данных о товарах.
- **Elasticsearch** для индексации данных и поиска.
- **Python** для обработки данных, парсинга XML и работы с базами данных.
- **Docker** для контейнеризации всех компонентов.

## Как запустить проект

### Предварительные шаги

1. Убедитесь, что у вас установлен Docker и Docker Compose.
2. Склонируйте репозиторий с проектом.

```bash
git clone <репозиторий>
cd <папка_проекта>
```

3. Поместите XML-файл с товарами в корень проекта и назовите его `offers.xml` или измените путь в коде, если нужно другое имя файла.

### Установка зависимостей

Для локального запуска установите необходимые Python-зависимости:

```bash
pip install -r requirements.txt
```

### Запуск с Docker

Проект настроен для работы с Docker Compose, что упрощает запуск всех необходимых сервисов.

1. Постройте и запустите контейнеры:

```bash
docker-compose up --build
```

2. Подождите, пока все сервисы будут готовы. Логи будут отображать статус подключения к PostgreSQL и Elasticsearch.

### Настройка индекса в Elasticsearch

После запуска контейнеров, сервис автоматически создаст индекс в Elasticsearch с соответствующей схемой.

## Проверка функционала

1. **Парсинг XML и загрузка в PostgreSQL**: 
   - Скрипт обрабатывает XML-файл и сохраняет данные в таблицу `sku` базы данных PostgreSQL.
   - Продукты загружаются партиями для оптимизации производительности.

2. **Индексация в Elasticsearch**:
   - После загрузки в базу данных товары индексируются в Elasticsearch.
   - Для проверки индекса можно воспользоваться командой:
   
   ```bash
   curl -X GET 'http://localhost:9200/products/_search?pretty'
   ```

   Это вернет список всех проиндексированных товаров.

## Как завершить выполнение

Чтобы завершить выполнение приложения и остановить все контейнеры:

```bash
docker-compose down
```

Это остановит и удалит все контейнеры, освобождая ресурсы.

## Логи

Логи работы приложения сохраняются в файл `app.log`. В нем можно отслеживать ошибки и этапы выполнения.

## Ошибки и возможные проблемы

- **Ошибка подключения к PostgreSQL или Elasticsearch**: Проверьте, что сервисы запущены и доступны. Возможно, стоит увеличить время ожидания в настройках контейнера.
- **Проблемы с памятью или производительностью**: Вы можете настроить лимиты использования ресурсов в файле `docker-compose.yml`.

---

Таким образом, проект автоматизирует процесс импорта данных с маркетплейса и их индексации для удобного поиска и анализа.

## Примеры UUID и similar_sku после матчинга

Ниже приведены примеры товаров с их соответствующими UUID и similar_sku, которые были заматчены на основе анализа данных:

| UUID товара (sku)                              | similar_sku (UUID заматченных товаров)                                    | Название товара            |
|-----------------------------------------------|------------------------------------------------------------------------|----------------------------|
| a3152e5b-c7c2-4338-ab6e-071d74f8bf9d          | 9b24ca74-d078-443e-b406-3723add701d8,73ef0a3b-7875-4900-8be7-b6104a288fdf,997833d8-8e4f-419e-a938-538ffa0063cd,e746af18-121a-4d8f-8401-282d04283bcd,5d0878e5-efd5-4d26-97fa-eb5193f38262 | Комплект 5 шт, Колонка портативная SONNEN B306, 12 Вт, Bluetooth, FM-тюнер, microSD, MP3-плеер, черная, 513479      |
| 68c6ddba-e444-402a-bd0f-59a41e2e9bd3          | cd823a44-1a52-4dba-950a-51a1809087ca,676ddf0e-d63f-48b8-aad3-b2d4175a3ebb,63404edd-4538-4050-85a2-1e99e03fd5dd,94f87603-eb68-4e90-97d6-8da0aa66665b,37c92f81-7774-44cd-9395-8213dd9217eb | Центральный канал CANTON GLE 50 Center black           |
| a30f111e-cca9-4e39-a60f-c3ce58f5a868          | aa7b97c0-1e54-4924-9632-8ef48e740bc5,6f255b2c-e99e-491f-9df9-dcb5866d1dea,a9044a04-16d0-4163-a7f2-4b75d92fdb49,6a7d21c0-1c45-48ce-9491-dc2a76f4b29a,a1eb96db-b5fa-4706-9b22-e35b29ae6d32 | 43" Телевизор LG 43UR81006LJ 2023 VA RU, черный          |
| f24c51ff-875a-4803-b784-d081e7bd251c          | 5e48d0b9-b6bb-467c-bdf7-a0c84aab586f,a30f111e-cca9-4e39-a60f-c3ce58f5a868,aa7b97c0-1e54-4924-9632-8ef48e740bc5,ab390de3-727d-4887-a84d-1c7c181c0b3f,2e42ad8a-f47c-4e9f-88ab-220ba52afefd | 55" Телевизор LG 55UR78001LJ 2023 VA, черный      |
| e8c8d2b6-5d5c-4011-9ae0-c97e64460d11          | 7f452d96-7f7c-43a5-938a-5278bb65b2ae,1688140b-e59a-4ae5-83ac-55dc23e51abc,5c873d75-3134-4dee-bbb0-7732b1cd02aa,c244ce79-ac52-4a38-be5f-cb6c3df03b88,51888133-e827-412f-8506-af55b6fd9475 | Смартфон Samsung Galaxy S22 8/128 ГБ, Dual: nano SIM + eSIM, Белый фантом |
